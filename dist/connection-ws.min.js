!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.connection=e()}}(function(){return function e(t,n,r){function o(u,s){if(!n[u]){if(!t[u]){var a="function"==typeof require&&require;if(!s&&a)return a(u,!0);if(i)return i(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[u]={exports:{}};t[u][0].call(l.exports,function(e){var n=t[u][1][e];return o(n?n:e)},l,l.exports,e,t,n,r)}return n[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(e,t,n){e("./lib/HttpConnection"),e("./lib/WebSocketConnection"),t.exports=e("./lib/connection")},{"./lib/HttpConnection":6,"./lib/WebSocketConnection":4,"./lib/connection":5}],2:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,n,o,i){r(this,e),this._address=t,this.options=n||{},"boolean"==typeof o?(this._secure=o,this._handler=null):(this._secure=i||!1,this._handler=o),this._protocol="http",this._listenerMap={}}return o(e,[{key:"getAddress",value:function(){return this.getProtocol()+"://"+this._address.replace(/^(\w+:\/\/)?/,"")}},{key:"getProtocol",value:function(){return this._protocol+(this._secure?"s":"")}},{key:"request",value:function(e,t){}},{key:"send",value:function(e,t){this.request(e,t)}},{key:"close",value:function(){}},{key:"on",value:function(e,t){if("function"==typeof t){var n=this._listenerMap[e]||(this._listenerMap[e]=[]);n.indexOf(t)<0&&n.push(t)}return this}},{key:"off",value:function(e,t){if("function"==typeof t){var n=this._listenerMap[e]||(this._listenerMap[e]=[]),r=n.indexOf(t);r>=0&&n.splice(r,1)}return this}},{key:"trigger",value:function(e){for(var t=this,n=arguments.length,r=Array(n>1?n-1:0),o=1;n>o;o++)r[o-1]=arguments[o];var i=this._listenerMap[e];return i&&i.forEach(function(e){return e.apply(t,r)}),this._handler&&"function"==typeof this._handler[e]&&this._handler[e].apply(this._handler,r),this}}]),e}();i.EVENT_OPEN="open",i.EVENT_CLOSE="close",i.EVENT_ERROR="error",i.EVENT_REQUEST="request",i.EVENT_SEND="send",i.EVENT_RESPONSE="response",i.EVENT_MESSAGE="message",i.EVENT_PROGRESS="progress",n["default"]=i,t.exports=n["default"]},{}],3:[function(e,t,n){"use strict";if("undefined"!=typeof window)window.WebSocket?t.exports=window.WebSocket:console.log("当前浏览器不支持WebSocket");else if("undefined"!=typeof WebSocket)t.exports=WebSocket;else{var r="ws";t.exports=e(r)}},{}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e,t,n){for(var r=!0;r;){var o=e,i=t,u=n;s=f=a=void 0,r=!1;var s=Object.getOwnPropertyDescriptor(o,i);if(void 0!==s){if("value"in s)return s.value;var a=s.get;return void 0===a?void 0:a.call(u)}var f=Object.getPrototypeOf(o);if(null===f)return void 0;e=f,t=i,n=u,r=!0}},a=e("./connection"),f=r(a),l=e("./BaseConnection"),c=r(l),d=e("./WebSocket"),p=r(d),h=function(e){function t(e,n,r){o(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this._protocol="ws",this._ws=null;var i=n&&n.deferred===!0||!1;i===!1&&this._connect()}return i(t,e),u(t,[{key:"getStatus",value:function(){return this._ws?this._ws.readyState:p["default"].CLOSED}},{key:"_connect",value:function(){var e=this;if("undefined"==typeof p["default"])throw Error("Don't support WebSocket");this._ws=new p["default"](this.getAddress()),void 0===p["default"].OPEN&&(p["default"].CONNECTING=this._ws.CONNECTING,p["default"].OPEN=this._ws.OPEN,p["default"].CLOSING=this._ws.CLOSING,p["default"].CLOSED=this._ws.CLOSED),this._ws.binaryType=this.options.binaryType||this.options.dataType||"arraybuffer",this._ws.addEventListener("open",function(){e.trigger(c["default"].EVENT_OPEN)}),this._ws.addEventListener("error",function(){e.trigger(c["default"].EVENT_ERROR)}),this._ws.addEventListener("close",function(){e.trigger(c["default"].EVENT_CLOSE)}),this._ws.addEventListener("message",function(t){e.trigger(c["default"].EVENT_MESSAGE,t.data),e.trigger(c["default"].EVENT_RESPONSE,t.data)})}},{key:"request",value:function(e,t){var n=this;return e=e||"",this.getStatus()===p["default"].CLOSED&&this._connect(),this.getStatus()!==p["default"].OPEN?this._ws.addEventListener("open",function(){n._ws.send(e),n.trigger(c["default"].EVENT_SEND),n.trigger(c["default"].EVENT_REQUEST)}):(this._ws.send(e),this.trigger(c["default"].EVENT_SEND),this.trigger(c["default"].EVENT_REQUEST)),this}},{key:"close",value:function(){return this.getStatus()!==p["default"].CLOSED&&(this._ws.close(),this._ws=null),this}}]),t}(c["default"]);n["default"]=h,f["default"].ws=function(e,t,n){return new h(e,t,n,!1)},f["default"].wss=function(e,t,n){return new h(e,t,n,!0)},t.exports=n["default"]},{"./BaseConnection":2,"./WebSocket":3,"./connection":5}],5:[function(e,t,n){"use strict";function r(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var n=[],r=!0,o=!1,i=void 0;try{for(var u,s=e[Symbol.iterator]();!(r=(u=s.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(a){o=!0,i=a}finally{try{!r&&s["return"]&&s["return"]()}finally{if(o)throw i}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")}function o(e,t,n){if("string"!=typeof e)throw new Error("url is incorrect");var i=/^((\w+):\/\/)?(.*)/.exec(e),u=r(i,4),s=u[2],a=void 0===s?"http":s,f=u[3],l=o[a];if(!l)throw new Error('protocol "'+a+'" no support');return l(f,t,n)}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o,t.exports=n["default"]},{}],6:[function(e,t,n){},{}]},{},[1])(1)});