!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.connection=e()}}(function(){return function e(t,r,n){function o(a,u){if(!r[a]){if(!t[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var f=r[a]={exports:{}};t[a][0].call(f.exports,function(e){var r=t[a][1][e];return o(r?r:e)},f,f.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){e("./lib/HttpConnection"),e("./lib/WebSocketConnection"),t.exports=e("./lib/connection")},{"./lib/HttpConnection":3,"./lib/WebSocketConnection":8,"./lib/connection":6}],2:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(t,r,o,i){n(this,e),this._address=t,this.options=r||{},"boolean"==typeof o?(this._secure=o,this._handler=null):(this._secure=i||!1,this._handler=o),this._protocol="http",this._listenerMap={}}return o(e,[{key:"getAddress",value:function(){return this.getProtocol()+"://"+this._address.replace(/^(\w+:\/\/)?/,"")}},{key:"getProtocol",value:function(){return this._protocol+(this._secure?"s":"")}},{key:"request",value:function(e,t){}},{key:"send",value:function(e,t){this.request(e,t)}},{key:"close",value:function(){}},{key:"on",value:function(e,t){if("function"==typeof t){var r=this._listenerMap[e]||(this._listenerMap[e]=[]);r.indexOf(t)<0&&r.push(t)}return this}},{key:"off",value:function(e,t){if("function"==typeof t){var r=this._listenerMap[e]||(this._listenerMap[e]=[]),n=r.indexOf(t);n>=0&&r.splice(n,1)}return this}},{key:"trigger",value:function(e){for(var t=this,r=arguments.length,n=Array(r>1?r-1:0),o=1;r>o;o++)n[o-1]=arguments[o];var i=this._listenerMap[e];return i&&i.forEach(function(e){return e.apply(t,n)}),this._handler&&"function"==typeof this._handler[e]&&this._handler[e].apply(this._handler,n),this}}]),e}();i.EVENT_OPEN="open",i.EVENT_CLOSE="close",i.EVENT_ERROR="error",i.EVENT_REQUEST="request",i.EVENT_SEND="send",i.EVENT_RESPONSE="response",i.EVENT_MESSAGE="message",i.EVENT_PROGRESS="progress",r["default"]=i,t.exports=r["default"]},{}],3:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=function(e,t,r){for(var n=!0;n;){var o=e,i=t,a=r;u=c=s=void 0,n=!1;var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var s=u.get;return void 0===s?void 0:s.call(a)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=i,r=a,n=!0}},s=e("./connection"),c=n(s),f=e("./BaseConnection"),l=n(f),p=e("./util"),d=e("./ajax"),y=n(d),h=function(e){function t(){for(var e=arguments.length,r=Array(e),n=0;e>n;n++)r[n]=arguments[n];o(this,t),u(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,r),this._request=[]}return i(t,e),a(t,[{key:"request",value:function(e,t){var r=this;t=(0,p.extend)({},this.options,t),t.success=function(e,t,n){r.trigger(l["default"].EVENT_MESSAGE,e),r.trigger(l["default"].EVENT_RESPONSE,e)},t.error=function(e,t,n){r.trigger(l["default"].EVENT_ERROR,n)},t.complete=function(){var e=r._request.indexOf(n);r._request.splice(e,1)},t.url=this.getAddress()+(e?e:"");var n=(0,y["default"])(t);return n&&(n.onreadystatechange=function(e){return function(){2===n.readyState&&(r.trigger(l["default"].EVENT_SEND),r.trigger(l["default"].EVENT_REQUEST)),e&&e()}}(n.onreadystatechange)),this.trigger(l["default"].EVENT_OPEN),this._request.push(n),n.onprogress=function(e){r.trigger(l["default"].EVENT_PROGRESS,e)},this}},{key:"close",value:function(){var e=this;return this._request.forEach(function(t,r){t.abort(),e._request.splice(r,1)}),this.trigger(l["default"].EVENT_CLOSE),this}}]),t}(l["default"]);r["default"]=h,c["default"].http=function(e,t,r){return new h(e,t,r,!1)},c["default"].https=function(e,t,r){return new h(e,t,r,!0)},t.exports=r["default"]},{"./BaseConnection":2,"./ajax":5,"./connection":6,"./util":7}],4:[function(e,t,r){"use strict";if("undefined"!=typeof window)window.XMLHttpRequest?t.exports=window.XMLHttpRequest:console.log("当前浏览器不支持XMLHttpRequest");else if("undefined"!=typeof XMLHttpRequest)t.exports=XMLHttpRequest;else{var n="xhr2",o=e(n);t.exports=o.XMLHttpRequest||o}},{}],5:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0})}function i(e){if("undefined"==typeof ArrayBuffer)throw new Error("不支持ArrayBuffer类型");if(e.response instanceof ArrayBuffer)return e.response;for(var t=e.responseText,r=t.length,n=new ArrayBuffer(r),o=new Uint8Array(n),i=0;r>i;i++)o[i]=255&t.charCodeAt(i);return n}function a(e){if("undefined"==typeof Blob)throw new Error("不支持Blob类型");if(e.response instanceof Blob)return e.response;var t=i(e);return new Blob([t])}var u=e("./XMLHttpRequest"),s=n(u),c=e("./util");if("undefined"!=typeof $&&"function"==typeof $.ajax&&"undefined"==typeof XDomainRequest){var f=function(e,t,r){return{send:function(t,r){var n,u,s,c;c=e.xhr(),s=e.url,u=e.type,n=e.data||null,c.onload=function(){var t="arraybuffer"===e.dataType?i(c):a(c),n=o({},e.dataType,t);return r(c.status,c.statusText,n,c.getAllResponseHeaders())},c.onerror="error",function(e){return r(-1,e)},c.ontimeout=function(e){return r(-1,e)},c.open(u,s,!0);var f="string"==typeof c.responseType;f?c.responseType=e.dataType:c.overrideMimeType?c.overrideMimeType("text/plain; charset=x-user-defined"):c.setRequestHeader("Accept-Charset","x-user-defined");for(var l in t)c.setRequestHeader(l,t[l]);return c.send(n)},abort:function(){return r.abort()}}},l=$.ajaxSettings.xhr;$.support.cors=!0,$.ajaxSetup({xhr:function _(){var _=l.call(this);return this.setXHR(_),_},beforeSend:function(e,t){t.setXHR=function(t){t.abort=e.abort,e.xhr=t}},crossDomain:!0}),$.ajaxTransport("+arraybuffer",f),$.ajaxTransport("+blob",f),t.exports=function(){var e=$.ajax.apply($,[].slice.call(arguments));return e.xhr}}else{var p,d,y,h,v,x,b,g,E,w,m,T;!function(){var e=function(e,t,r){return!0},r=function(t,r,n,o){return t.global?e(r||y,n,o):void 0},n=function(e){e.global&&0===T.active++&&r(e,null,"ajaxStart")},o=function(e){e.global&&!--T.active&&r(e,null,"ajaxStop")},u=function(e,t){var n=t.context;return t.beforeSend.call(n,e,t)===!1||r(t,n,"ajaxBeforeSend",[e,t])===!1?!1:void r(t,n,"ajaxSend",[e,t])},f=function(e,t,n){var o=n.context,i="success";n.success.call(o,e,i,t),r(n,o,"ajaxSuccess",[t,n,e]),_(i,t,n)},l=function(e,t,n,o){var i=o.context;o.error.call(i,n,t,e),r(o,i,"ajaxError",[n,o,e]),_(t,n,o)},_=function(e,t,n){var i=n.context;n.complete.call(i,t,e),r(n,i,"ajaxComplete",[t,n]),o(n)},S=function(){},j=function(e){return e&&(e==w?"html":e==E?"json":b.test(e)?"script":g.test(e)&&"xml")||"text"},R=function(e,t){return(e+"&"+t).replace(/[&?]{1,2}/,"?")},O=function(e){"object"==typeof e.data&&(e.data=(0,c.param)(e.data)),!e.data||e.type&&"GET"!=e.type.toUpperCase()||(e.url=R(e.url,e.data))};p=0,d="undefined"==typeof window,y=!d&&window.document,x=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,b=/^(?:text|application)\/javascript/i,g=/^(?:text|application)\/xml/i,E="application/json",w="text/html",m=/^\s*$/,T=t.exports=function(e){var t=(0,c.extend)({},e||{});for(h in T.settings)void 0===t[h]&&(t[h]=T.settings[h]);n(t),t.crossDomain||(t.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(t.url)&&!d&&!!window.location&&RegExp.$2!=window.location.host);var r=t.dataType,o=/=\?/.test(t.url);if("jsonp"==r||o)return o||(t.url=R(t.url,"callback=?")),T.JSONP(t);t.url||(t.url=!d&&!!window.location&&window.location.toString()),O(t);var s,p=t.accepts[r],y={},x=/^([\w-]+:)\/\//.test(t.url)?RegExp.$1:!d&&!!window.location&&window.location.protocol,b=T.settings.xhr();t.crossDomain?"undefined"!=typeof XDomainRequest&&(b=new XDomainRequest,b.onload=function(){b.readyState=4,b.status=200,b.onreadystatechange()},b.error=function(){b.readyState=4,b.status=400,b.onreadystatechange()}):y["X-Requested-With"]="XMLHttpRequest",p&&(y.Accept=p,p.indexOf(",")>-1&&(p=p.split(",",2)[0]),b.overrideMimeType&&b.overrideMimeType(p)),(t.contentType||t.data&&"GET"!=t.type.toUpperCase())&&(y["Content-Type"]=t.contentType||"application/x-www-form-urlencoded"),t.headers=(0,c.extend)(y,t.headers||{}),b.onreadystatechange=function(){if(4==b.readyState){clearTimeout(s);var e,n=!1;if(b.status>=200&&b.status<300||304==b.status||0==b.status&&"file:"==x){r=r||j(b.contentType||b.getResponseHeader&&b.getResponseHeader("content-type"));try{"script"==r?(1,eval)(e):e="xml"==r?b.responseXML:"json"==r?m.test(b.responseText)?null:JSON.parse(b.responseText):"arraybuffer"===r?i(b):"blob"===r?a(b):b.responseText}catch(o){n=o}n?l(n,"parsererror",b,t):f(e,b,t)}else l(null,"error",b,t)}};var g="async"in t?t.async:!0;if(b.open(t.type,t.url,g),"arraybuffer"==r||"blob"==r){var E="string"==typeof b.responseType;E?b.responseType=e.dataType:b.overrideMimeType?b.overrideMimeType("text/plain; charset=x-user-defined"):b.setRequestHeader("Accept-Charset","x-user-defined")}for(v in t.headers)b.setRequestHeader(v,t.headers[v]);return u(b,t)===!1?(b.abort(),!1):(t.timeout>0&&(s=setTimeout(function(){b.onreadystatechange=S,b.abort(),l(null,"timeout",b,t)},t.timeout)),b.send(t.data?t.data:null),b)},T.active=0,T.JSONP=function(e){if(!("type"in e))return T(e);var t,r="jsonp"+ ++p,n=y.createElement("script"),o=function(){!d&&r in window&&(window[r]=S),_("abort",i,e)},i={abort:o},a=y.getElementsByTagName("head")[0]||y.documentElement;return e.error&&(n.onerror=function(){i.abort(),e.error()}),d||(window[r]=function(n){clearTimeout(t),delete window[r],f(n,i,e)}),O(e),n.src=e.url.replace(/=\?/,"="+r),a.insertBefore(n,a.firstChild),e.timeout>0&&(t=setTimeout(function(){i.abort(),_("timeout",i,e)},e.timeout)),i},T.settings={type:"GET",beforeSend:S,success:S,error:S,complete:S,context:null,global:!0,xhr:function(){return new s["default"]},accepts:{script:"text/javascript, application/javascript",json:E,xml:"application/xml, text/xml",html:w,text:"text/plain"},crossDomain:!1,timeout:0},T.get=function(e,t){return T({url:e,success:t})},T.post=function(e,t,r,n){return"function"==typeof t&&(n=n||r,r=t,t=null),T({type:"POST",url:e,data:t,success:r,dataType:n})},T.getJSON=function(e,t){return T({url:e,success:t,dataType:"json"})}}()}},{"./XMLHttpRequest":4,"./util":7}],6:[function(e,t,r){"use strict";function n(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(s){o=!0,i=s}finally{try{!n&&u["return"]&&u["return"]()}finally{if(o)throw i}}return r}throw new TypeError("Invalid attempt to destructure non-iterable instance")}function o(e,t,r){if("string"!=typeof e)throw new Error("url is incorrect");var i=/^((\w+):\/\/)?(.*)/.exec(e),a=n(i,4),u=a[2],s=void 0===u?"http":u,c=a[3],f=o[s];if(!f)throw new Error('protocol "'+s+'" no support');return f(c,t,r)}Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=o,t.exports=r["default"]},{}],7:[function(e,t,r){"use strict";function n(e,t,r,o){var i=t instanceof Array;for(var a in t){var u=t[a];o&&(a=r?o:o+"["+(i?"":a)+"]"),!o&&i?e.add(u.name,u.value):(r?u instanceof Array:"object"==typeof u)?n(e,u,r,a):e.add(a,u)}}function o(e,t){var r=[];return r.add=function(e,t){this.push(a(e)+"="+a(t))},n(r,e,t),r.join("&").replace("%20","+")}function i(e){var t=Array.prototype.slice;return t.call(arguments,1).forEach(function(t){for(var r in t)void 0!==t[r]&&(e[r]=t[r])}),e}Object.defineProperty(r,"__esModule",{value:!0}),r.serialize=n,r.param=o,r.extend=i;var a=encodeURIComponent},{}],8:[function(e,t,r){},{}]},{},[1])(1)});