!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.connection=e()}}(function(){return function e(t,n,r){function o(a,u){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[a]={exports:{}};t[a][0].call(f.exports,function(e){var n=t[a][1][e];return o(n?n:e)},f,f.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){e("./lib/HttpConnection"),e("./lib/WebSocketConnection"),t.exports=e("./lib/connection")},{"./lib/HttpConnection":3,"./lib/WebSocketConnection":5,"./lib/connection":8}],2:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,n,o,i){r(this,e),this._address=t,this.options=n||{},"boolean"==typeof o?(this._secure=o,this._handler=null):(this._secure=i||!1,this._handler=o),this._protocol="http",this._listenerMap={}}return o(e,[{key:"getAddress",value:function(){return this.getProtocol()+"://"+this._address.replace(/^(\w+:\/\/)?/,"")}},{key:"getProtocol",value:function(){return this._protocol+(this._secure?"s":"")}},{key:"request",value:function(e,t){}},{key:"send",value:function(e,t){this.request(e,t)}},{key:"close",value:function(){}},{key:"on",value:function(e,t){if("function"==typeof t){var n=this._listenerMap[e]||(this._listenerMap[e]=[]);n.indexOf(t)<0&&n.push(t)}return this}},{key:"off",value:function(e,t){if("function"==typeof t){var n=this._listenerMap[e]||(this._listenerMap[e]=[]),r=n.indexOf(t);r>=0&&n.splice(r,1)}return this}},{key:"trigger",value:function(e){for(var t=this,n=arguments.length,r=Array(n>1?n-1:0),o=1;n>o;o++)r[o-1]=arguments[o];var i=this._listenerMap[e];return i&&i.forEach(function(e){return e.apply(t,r)}),this._handler&&"function"==typeof this._handler[e]&&this._handler[e].apply(this._handler,r),this}}]),e}();i.EVENT_OPEN="open",i.EVENT_CLOSE="close",i.EVENT_ERROR="error",i.EVENT_REQUEST="request",i.EVENT_SEND="send",i.EVENT_RESPONSE="response",i.EVENT_MESSAGE="message",i.EVENT_PROGRESS="progress",n["default"]=i,t.exports=n["default"]},{}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;u=c=s=void 0,r=!1;var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var s=u.get;return void 0===s?void 0:s.call(a)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=i,n=a,r=!0}},s=e("./connection"),c=r(s),f=e("./BaseConnection"),l=r(f),p=e("./util"),d=e("./ajax"),y=r(d),h=function(e){function t(){for(var e=arguments.length,n=Array(e),r=0;e>r;r++)n[r]=arguments[r];o(this,t),u(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,n),this._request=[]}return i(t,e),a(t,[{key:"request",value:function(e,t){var n=this;t=(0,p.extend)({},this.options,t),t.success=function(e,t,r){n.trigger(l["default"].EVENT_MESSAGE,e),n.trigger(l["default"].EVENT_RESPONSE,e)},t.error=function(e,t,r){n.trigger(l["default"].EVENT_ERROR,r)},t.complete=function(){var e=n._request.indexOf(r);n._request.splice(e,1)},t.url=this.getAddress()+(e?e:"");var r=(0,y["default"])(t);return r&&(r.onreadystatechange=function(e){return function(){2===r.readyState&&(n.trigger(l["default"].EVENT_SEND),n.trigger(l["default"].EVENT_REQUEST)),e&&e()}}(r.onreadystatechange)),this.trigger(l["default"].EVENT_OPEN),this._request.push(r),r.onprogress=function(e){n.trigger(l["default"].EVENT_PROGRESS,e)},this}},{key:"close",value:function(){var e=this;return this._request.forEach(function(t,n){t.abort(),e._request.splice(n,1)}),this.trigger(l["default"].EVENT_CLOSE),this}}]),t}(l["default"]);n["default"]=h,c["default"].http=function(e,t,n){return new h(e,t,n,!1)},c["default"].https=function(e,t,n){return new h(e,t,n,!0)},t.exports=n["default"]},{"./BaseConnection":2,"./ajax":7,"./connection":8,"./util":9}],4:[function(e,t,n){"use strict";if("undefined"!=typeof window)window.WebSocket?t.exports=window.WebSocket:console.log("当前浏览器不支持WebSocket");else if("undefined"!=typeof WebSocket)t.exports=WebSocket;else{var r="ws";t.exports=e(r)}},{}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;u=c=s=void 0,r=!1;var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var s=u.get;return void 0===s?void 0:s.call(a)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=i,n=a,r=!0}},s=e("./connection"),c=r(s),f=e("./BaseConnection"),l=r(f),p=e("./WebSocket"),d=r(p),y=function(e){function t(e,n,r){o(this,t),u(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this._protocol="ws",this._ws=null;var i=n&&n.deferred===!0||!1;i===!1&&this._connect()}return i(t,e),a(t,[{key:"getStatus",value:function(){return this._ws?this._ws.readyState:d["default"].CLOSED}},{key:"_connect",value:function(){var e=this;if("undefined"==typeof d["default"])throw Error("Don't support WebSocket");this._ws=new d["default"](this.getAddress()),void 0===d["default"].OPEN&&(d["default"].CONNECTING=this._ws.CONNECTING,d["default"].OPEN=this._ws.OPEN,d["default"].CLOSING=this._ws.CLOSING,d["default"].CLOSED=this._ws.CLOSED),this._ws.binaryType=this.options.binaryType||this.options.dataType||"arraybuffer",this._ws.addEventListener("open",function(){e.trigger(l["default"].EVENT_OPEN)}),this._ws.addEventListener("error",function(){e.trigger(l["default"].EVENT_ERROR)}),this._ws.addEventListener("close",function(){e.trigger(l["default"].EVENT_CLOSE)}),this._ws.addEventListener("message",function(t){e.trigger(l["default"].EVENT_MESSAGE,t.data),e.trigger(l["default"].EVENT_RESPONSE,t.data)})}},{key:"request",value:function(e,t){var n=this;return e=e||"",this.getStatus()===d["default"].CLOSED&&this._connect(),this.getStatus()!==d["default"].OPEN?this._ws.addEventListener("open",function(){n._ws.send(e),n.trigger(l["default"].EVENT_SEND),n.trigger(l["default"].EVENT_REQUEST)}):(this._ws.send(e),this.trigger(l["default"].EVENT_SEND),this.trigger(l["default"].EVENT_REQUEST)),this}},{key:"close",value:function(){return this.getStatus()!==d["default"].CLOSED&&(this._ws.close(),this._ws=null),this}}]),t}(l["default"]);n["default"]=y,c["default"].ws=function(e,t,n){return new y(e,t,n,!1)},c["default"].wss=function(e,t,n){return new y(e,t,n,!0)},t.exports=n["default"]},{"./BaseConnection":2,"./WebSocket":4,"./connection":8}],6:[function(e,t,n){"use strict";if("undefined"!=typeof window)window.XMLHttpRequest?t.exports=window.XMLHttpRequest:console.log("当前浏览器不支持XMLHttpRequest");else if("undefined"!=typeof XMLHttpRequest)t.exports=XMLHttpRequest;else{var r="xhr2",o=e(r);t.exports=o.XMLHttpRequest||o}},{}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0})}function i(e){if("undefined"==typeof ArrayBuffer)throw new Error("不支持ArrayBuffer类型");if(e.response instanceof ArrayBuffer)return e.response;for(var t=e.responseText,n=t.length,r=new ArrayBuffer(n),o=new Uint8Array(r),i=0;n>i;i++)o[i]=255&t.charCodeAt(i);return r}function a(e){if("undefined"==typeof Blob)throw new Error("不支持Blob类型");if(e.response instanceof Blob)return e.response;var t=i(e);return new Blob([t])}var u=e("./XMLHttpRequest"),s=r(u),c=e("./util");if("undefined"!=typeof $&&"function"==typeof $.ajax&&"undefined"==typeof XDomainRequest){var f=function(e,t,n){return{send:function(t,n){var r,u,s,c;c=e.xhr(),s=e.url,u=e.type,r=e.data||null,c.onload=function(){var t="arraybuffer"===e.dataType?i(c):a(c),r=o({},e.dataType,t);return n(c.status,c.statusText,r,c.getAllResponseHeaders())},c.onerror="error",function(e){return n(-1,e)},c.ontimeout=function(e){return n(-1,e)},c.open(u,s,!0);var f="string"==typeof c.responseType;f?c.responseType=e.dataType:c.overrideMimeType?c.overrideMimeType("text/plain; charset=x-user-defined"):c.setRequestHeader("Accept-Charset","x-user-defined");for(var l in t)c.setRequestHeader(l,t[l]);return c.send(r)},abort:function(){return n.abort()}}},l=$.ajaxSettings.xhr;$.support.cors=!0,$.ajaxSetup({xhr:function m(){var m=l.call(this);return this.setXHR(m),m},beforeSend:function(e,t){t.setXHR=function(t){t.abort=e.abort,e.xhr=t}},crossDomain:!0}),$.ajaxTransport("+arraybuffer",f),$.ajaxTransport("+blob",f),t.exports=function(){var e=$.ajax.apply($,[].slice.call(arguments));return e.xhr}}else{var p,d,y,h,v,E,g,w,b,_,x,T;!function(){var e=function(e,t,n){return!0},n=function(t,n,r,o){return t.global?e(n||y,r,o):void 0},r=function(e){e.global&&0===T.active++&&n(e,null,"ajaxStart")},o=function(e){e.global&&!--T.active&&n(e,null,"ajaxStop")},u=function(e,t){var r=t.context;return t.beforeSend.call(r,e,t)===!1||n(t,r,"ajaxBeforeSend",[e,t])===!1?!1:void n(t,r,"ajaxSend",[e,t])},f=function(e,t,r){var o=r.context,i="success";r.success.call(o,e,i,t),n(r,o,"ajaxSuccess",[t,r,e]),m(i,t,r)},l=function(e,t,r,o){var i=o.context;o.error.call(i,r,t,e),n(o,i,"ajaxError",[r,o,e]),m(t,r,o)},m=function(e,t,r){var i=r.context;r.complete.call(i,t,e),n(r,i,"ajaxComplete",[t,r]),o(r)},S=function(){},O=function(e){return e&&(e==_?"html":e==b?"json":g.test(e)?"script":w.test(e)&&"xml")||"text"},N=function(e,t){return(e+"&"+t).replace(/[&?]{1,2}/,"?")},j=function(e){"object"==typeof e.data&&(e.data=(0,c.param)(e.data)),!e.data||e.type&&"GET"!=e.type.toUpperCase()||(e.url=N(e.url,e.data))};p=0,d="undefined"==typeof window,y=!d&&window.document,E=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,g=/^(?:text|application)\/javascript/i,w=/^(?:text|application)\/xml/i,b="application/json",_="text/html",x=/^\s*$/,T=t.exports=function(e){var t=(0,c.extend)({},e||{});for(h in T.settings)void 0===t[h]&&(t[h]=T.settings[h]);r(t),t.crossDomain||(t.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(t.url)&&!d&&!!window.location&&RegExp.$2!=window.location.host);var n=t.dataType,o=/=\?/.test(t.url);if("jsonp"==n||o)return o||(t.url=N(t.url,"callback=?")),T.JSONP(t);t.url||(t.url=!d&&!!window.location&&window.location.toString()),j(t);var s,p=t.accepts[n],y={},E=/^([\w-]+:)\/\//.test(t.url)?RegExp.$1:!d&&!!window.location&&window.location.protocol,g=T.settings.xhr();t.crossDomain?"undefined"!=typeof XDomainRequest&&(g=new XDomainRequest,g.onload=function(){g.readyState=4,g.status=200,g.onreadystatechange()},g.error=function(){g.readyState=4,g.status=400,g.onreadystatechange()}):y["X-Requested-With"]="XMLHttpRequest",p&&(y.Accept=p,p.indexOf(",")>-1&&(p=p.split(",",2)[0]),g.overrideMimeType&&g.overrideMimeType(p)),(t.contentType||t.data&&"GET"!=t.type.toUpperCase())&&(y["Content-Type"]=t.contentType||"application/x-www-form-urlencoded"),t.headers=(0,c.extend)(y,t.headers||{}),g.onreadystatechange=function(){if(4==g.readyState){clearTimeout(s);var e,r=!1;if(g.status>=200&&g.status<300||304==g.status||0==g.status&&"file:"==E){n=n||O(g.contentType||g.getResponseHeader&&g.getResponseHeader("content-type"));try{"script"==n?(1,eval)(e):e="xml"==n?g.responseXML:"json"==n?x.test(g.responseText)?null:JSON.parse(g.responseText):"arraybuffer"===n?i(g):"blob"===n?a(g):g.responseText}catch(o){r=o}r?l(r,"parsererror",g,t):f(e,g,t)}else l(null,"error",g,t)}};var w="async"in t?t.async:!0;if(g.open(t.type,t.url,w),"arraybuffer"==n||"blob"==n){var b="string"==typeof g.responseType;b?g.responseType=e.dataType:g.overrideMimeType?g.overrideMimeType("text/plain; charset=x-user-defined"):g.setRequestHeader("Accept-Charset","x-user-defined")}for(v in t.headers)g.setRequestHeader(v,t.headers[v]);return u(g,t)===!1?(g.abort(),!1):(t.timeout>0&&(s=setTimeout(function(){g.onreadystatechange=S,g.abort(),l(null,"timeout",g,t)},t.timeout)),g.send(t.data?t.data:null),g)},T.active=0,T.JSONP=function(e){if(!("type"in e))return T(e);var t,n="jsonp"+ ++p,r=y.createElement("script"),o=function(){!d&&n in window&&(window[n]=S),m("abort",i,e)},i={abort:o},a=y.getElementsByTagName("head")[0]||y.documentElement;return e.error&&(r.onerror=function(){i.abort(),e.error()}),d||(window[n]=function(r){clearTimeout(t),delete window[n],f(r,i,e)}),j(e),r.src=e.url.replace(/=\?/,"="+n),a.insertBefore(r,a.firstChild),e.timeout>0&&(t=setTimeout(function(){i.abort(),m("timeout",i,e)},e.timeout)),i},T.settings={type:"GET",beforeSend:S,success:S,error:S,complete:S,context:null,global:!0,xhr:function(){return new s["default"]},accepts:{script:"text/javascript, application/javascript",json:b,xml:"application/xml, text/xml",html:_,text:"text/plain"},crossDomain:!1,timeout:0},T.get=function(e,t){return T({url:e,success:t})},T.post=function(e,t,n,r){return"function"==typeof t&&(r=r||n,n=t,t=null),T({type:"POST",url:e,data:t,success:n,dataType:r})},T.getJSON=function(e,t){return T({url:e,success:t,dataType:"json"})}}()}},{"./XMLHttpRequest":6,"./util":9}],8:[function(e,t,n){"use strict";function r(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(s){o=!0,i=s}finally{try{!r&&u["return"]&&u["return"]()}finally{if(o)throw i}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")}function o(e,t,n){if("string"!=typeof e)throw new Error("url is incorrect");var i=/^((\w+):\/\/)?(.*)/.exec(e),a=r(i,4),u=a[2],s=void 0===u?"http":u,c=a[3],f=o[s];if(!f)throw new Error('protocol "'+s+'" no support');return f(c,t,n)}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o,t.exports=n["default"]},{}],9:[function(e,t,n){"use strict";function r(e,t,n,o){var i=t instanceof Array;for(var a in t){var u=t[a];o&&(a=n?o:o+"["+(i?"":a)+"]"),!o&&i?e.add(u.name,u.value):(n?u instanceof Array:"object"==typeof u)?r(e,u,n,a):e.add(a,u)}}function o(e,t){var n=[];return n.add=function(e,t){this.push(a(e)+"="+a(t))},r(n,e,t),n.join("&").replace("%20","+")}function i(e){var t=Array.prototype.slice;return t.call(arguments,1).forEach(function(t){for(var n in t)void 0!==t[n]&&(e[n]=t[n])}),e}Object.defineProperty(n,"__esModule",{value:!0}),n.serialize=r,n.param=o,n.extend=i;var a=encodeURIComponent},{}]},{},[1])(1)});